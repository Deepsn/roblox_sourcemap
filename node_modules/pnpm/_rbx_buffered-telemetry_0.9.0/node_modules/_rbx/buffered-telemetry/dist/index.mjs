var e=function(e){return{_tag:"Left",left:e}},t=function(e){return{_tag:"Right",right:e}},n={_tag:"None"},r=function(e){return{_tag:"Some",value:e}},o=function(e){return function(t){return a(t)?n:r(e(t.value))}},i=function(e){return"Left"===e._tag?n:r(e.right)},u=function(e){return"Some"===e._tag},a=function(e){return"None"===e._tag},c=function(e){return function(t){return a(t)?e():t.value}},s=function(){function e(e,t){if(this.bufferIndex=0,e<1)throw new Error("EventPublishers must have size of at least 1!");this.maxEventQueueLength=e,this.eventQueue=new Array(this.maxEventQueueLength).fill(n),this.delegatePublisher=t,this.appendEvent=this.appendEvent.bind(this),this.publish=this.publish.bind(this)}return e.prototype.appendEvent=function(e){var t=this.bufferIndex%this.maxEventQueueLength,n=this.eventQueue[t];return this.eventQueue[t]=r(e),this.bufferIndex%=this.maxEventQueueLength,this.bufferIndex+=1,u(n)},e.prototype.publish=function(){this.delegatePublisher.publish(this.eventQueue.filter(u))},e}();function l(e,t,n,r){return new(n||(n=Promise))(function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,a)}c((r=r.apply(e,t||[])).next())})}function f(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=a(0),u.throw=a(1),u.return=a(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d=function(e){return e&&e.Math===Math&&e},m=d("object"==typeof globalThis&&globalThis)||d("object"==typeof window&&window)||d("object"==typeof self&&self)||d("object"==typeof p&&p)||d("object"==typeof p&&p)||function(){return this}()||Function("return this")(),h={},y=function(e){try{return!!e()}catch(e){return!0}},b=!y(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),v=!y(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),g=v,w=Function.prototype.call,S=g?w.bind(w):function(){return w.apply(w,arguments)},j={},T={}.propertyIsEnumerable,E=Object.getOwnPropertyDescriptor,O=E&&!T.call({1:2},1);j.f=O?function(e){var t=E(this,e);return!!t&&t.enumerable}:T;var x,R,P=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},N=v,k=Function.prototype,I=k.call,A=N&&k.bind.bind(I,I),C=N?A:function(e){return function(){return I.apply(e,arguments)}},D=C,U=D({}.toString),V=D("".slice),q=y,$=function(e){return V(U(e),8,-1)},z=Object,_=C("".split),L=q(function(){return!z("z").propertyIsEnumerable(0)})?function(e){return"String"===$(e)?_(e,""):z(e)}:z,M=function(e){return null==e},F=M,B=TypeError,G=function(e){if(F(e))throw new B("Can't call method on "+e);return e},H=L,Q=G,W=function(e){return H(Q(e))},K="object"==typeof document&&document.all,J=void 0===K&&void 0!==K?function(e){return"function"==typeof e||e===K}:function(e){return"function"==typeof e},X=J,Y=function(e){return"object"==typeof e?null!==e:X(e)},Z=m,ee=J,te=function(e,t){return arguments.length<2?(n=Z[e],ee(n)?n:void 0):Z[e]&&Z[e][t];var n},ne=C({}.isPrototypeOf),re=m.navigator,oe=re&&re.userAgent,ie=m,ue=oe?String(oe):"",ae=ie.process,ce=ie.Deno,se=ae&&ae.versions||ce&&ce.version,le=se&&se.v8;le&&(R=(x=le.split("."))[0]>0&&x[0]<4?1:+(x[0]+x[1])),!R&&ue&&(!(x=ue.match(/Edge\/(\d+)/))||x[1]>=74)&&(x=ue.match(/Chrome\/(\d+)/))&&(R=+x[1]);var fe=R,pe=y,de=m.String,me=!!Object.getOwnPropertySymbols&&!pe(function(){var e=Symbol("symbol detection");return!de(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&fe&&fe<41}),he=me&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ye=te,be=J,ve=ne,ge=Object,we=he?function(e){return"symbol"==typeof e}:function(e){var t=ye("Symbol");return be(t)&&ve(t.prototype,ge(e))},Se=String,je=J,Te=function(e){try{return Se(e)}catch(e){return"Object"}},Ee=TypeError,Oe=function(e){if(je(e))return e;throw new Ee(Te(e)+" is not a function")},xe=Oe,Re=M,Pe=S,Ne=J,ke=Y,Ie=TypeError,Ae={exports:{}},Ce=m,De=Object.defineProperty,Ue=function(e,t){try{De(Ce,e,{value:t,configurable:!0,writable:!0})}catch(n){Ce[e]=t}return t},Ve=m,qe=Ue,$e="__core-js_shared__",ze=Ae.exports=Ve[$e]||qe($e,{});(ze.versions||(ze.versions=[])).push({version:"3.43.0",mode:"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _e=Ae.exports,Le=_e,Me=function(e,t){return Le[e]||(Le[e]=t||{})},Fe=G,Be=Object,Ge=function(e){return Be(Fe(e))},He=C({}.hasOwnProperty),Qe=Object.hasOwn||function(e,t){return He(Ge(e),t)},We=C,Ke=0,Je=Math.random(),Xe=We(1.1.toString),Ye=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Xe(++Ke+Je,36)},Ze=Me,et=Qe,tt=Ye,nt=me,rt=he,ot=m.Symbol,it=Ze("wks"),ut=rt?ot.for||ot:ot&&ot.withoutSetter||tt,at=S,ct=Y,st=we,lt=function(e,t){var n=e[t];return Re(n)?void 0:xe(n)},ft=function(e,t){var n,r;if("string"===t&&Ne(n=e.toString)&&!ke(r=Pe(n,e)))return r;if(Ne(n=e.valueOf)&&!ke(r=Pe(n,e)))return r;if("string"!==t&&Ne(n=e.toString)&&!ke(r=Pe(n,e)))return r;throw new Ie("Can't convert object to primitive value")},pt=TypeError,dt=function(e){return et(it,e)||(it[e]=nt&&et(ot,e)?ot[e]:ut("Symbol."+e)),it[e]}("toPrimitive"),mt=function(e,t){if(!ct(e)||st(e))return e;var n,r=lt(e,dt);if(r){if(void 0===t&&(t="default"),n=at(r,e,t),!ct(n)||st(n))return n;throw new pt("Can't convert object to primitive value")}return void 0===t&&(t="number"),ft(e,t)},ht=we,yt=function(e){var t=mt(e,"string");return ht(t)?t:t+""},bt=Y,vt=m.document,gt=bt(vt)&&bt(vt.createElement),wt=function(e){return gt?vt.createElement(e):{}},St=!b&&!y(function(){return 7!==Object.defineProperty(wt("div"),"a",{get:function(){return 7}}).a}),jt=b,Tt=S,Et=j,Ot=P,xt=W,Rt=yt,Pt=Qe,Nt=St,kt=Object.getOwnPropertyDescriptor;h.f=jt?kt:function(e,t){if(e=xt(e),t=Rt(t),Nt)try{return kt(e,t)}catch(e){}if(Pt(e,t))return Ot(!Tt(Et.f,e,t),e[t])};var It={},At=b&&y(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Ct=Y,Dt=String,Ut=TypeError,Vt=function(e){if(Ct(e))return e;throw new Ut(Dt(e)+" is not an object")},qt=b,$t=St,zt=At,_t=Vt,Lt=yt,Mt=TypeError,Ft=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Gt="enumerable",Ht="configurable",Qt="writable";It.f=qt?zt?function(e,t,n){if(_t(e),t=Lt(t),_t(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Qt in n&&!n[Qt]){var r=Bt(e,t);r&&r[Qt]&&(e[t]=n.value,n={configurable:Ht in n?n[Ht]:r[Ht],enumerable:Gt in n?n[Gt]:r[Gt],writable:!1})}return Ft(e,t,n)}:Ft:function(e,t,n){if(_t(e),t=Lt(t),_t(n),$t)try{return Ft(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new Mt("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Wt=It,Kt=P,Jt=b?function(e,t,n){return Wt.f(e,t,Kt(1,n))}:function(e,t,n){return e[t]=n,e},Xt={exports:{}},Yt=b,Zt=Qe,en=Function.prototype,tn=Yt&&Object.getOwnPropertyDescriptor,nn=Zt(en,"name"),rn={EXISTS:nn,PROPER:nn&&"something"===function(){}.name,CONFIGURABLE:nn&&(!Yt||Yt&&tn(en,"name").configurable)},on=J,un=_e,an=C(Function.toString);on(un.inspectSource)||(un.inspectSource=function(e){return an(e)});var cn,sn,ln,fn=un.inspectSource,pn=J,dn=m.WeakMap,mn=pn(dn)&&/native code/.test(String(dn)),hn=Ye,yn=Me("keys"),bn={},vn=mn,gn=m,wn=Y,Sn=Jt,jn=Qe,Tn=_e,En=function(e){return yn[e]||(yn[e]=hn(e))},On=bn,xn="Object already initialized",Rn=gn.TypeError,Pn=gn.WeakMap;if(vn||Tn.state){var Nn=Tn.state||(Tn.state=new Pn);Nn.get=Nn.get,Nn.has=Nn.has,Nn.set=Nn.set,cn=function(e,t){if(Nn.has(e))throw new Rn(xn);return t.facade=e,Nn.set(e,t),t},sn=function(e){return Nn.get(e)||{}},ln=function(e){return Nn.has(e)}}else{var kn=En("state");On[kn]=!0,cn=function(e,t){if(jn(e,kn))throw new Rn(xn);return t.facade=e,Sn(e,kn,t),t},sn=function(e){return jn(e,kn)?e[kn]:{}},ln=function(e){return jn(e,kn)}}var In={set:cn,get:sn,has:ln,enforce:function(e){return ln(e)?sn(e):cn(e,{})},getterFor:function(e){return function(t){var n;if(!wn(t)||(n=sn(t)).type!==e)throw new Rn("Incompatible receiver, "+e+" required");return n}}},An=C,Cn=y,Dn=J,Un=Qe,Vn=b,qn=rn.CONFIGURABLE,$n=fn,zn=In.enforce,_n=In.get,Ln=String,Mn=Object.defineProperty,Fn=An("".slice),Bn=An("".replace),Gn=An([].join),Hn=Vn&&!Cn(function(){return 8!==Mn(function(){},"length",{value:8}).length}),Qn=String(String).split("String"),Wn=Xt.exports=function(e,t,n){"Symbol("===Fn(Ln(t),0,7)&&(t="["+Bn(Ln(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Un(e,"name")||qn&&e.name!==t)&&(Vn?Mn(e,"name",{value:t,configurable:!0}):e.name=t),Hn&&n&&Un(n,"arity")&&e.length!==n.arity&&Mn(e,"length",{value:n.arity});try{n&&Un(n,"constructor")&&n.constructor?Vn&&Mn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=zn(e);return Un(r,"source")||(r.source=Gn(Qn,"string"==typeof t?t:"")),e};Function.prototype.toString=Wn(function(){return Dn(this)&&_n(this).source||$n(this)},"toString");var Kn=Xt.exports,Jn=J,Xn=It,Yn=Kn,Zn=Ue,er={},tr=Math.ceil,nr=Math.floor,rr=Math.trunc||function(e){var t=+e;return(t>0?nr:tr)(t)},or=function(e){var t=+e;return t!=t||0===t?0:rr(t)},ir=or,ur=Math.max,ar=Math.min,cr=or,sr=Math.min,lr=function(e){var t=cr(e);return t>0?sr(t,9007199254740991):0},fr=W,pr=function(e,t){var n=ir(e);return n<0?ur(n+t,0):ar(n,t)},dr=function(e){return lr(e.length)},mr=function(e){return function(t,n,r){var o=fr(t),i=dr(o);if(0===i)return!e&&-1;var u,a=pr(r,i);if(e&&n!=n){for(;i>a;)if((u=o[a++])!=u)return!0}else for(;i>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},hr={includes:mr(!0),indexOf:mr(!1)},yr=Qe,br=W,vr=hr.indexOf,gr=bn,wr=C([].push),Sr=function(e,t){var n,r=br(e),o=0,i=[];for(n in r)!yr(gr,n)&&yr(r,n)&&wr(i,n);for(;t.length>o;)yr(r,n=t[o++])&&(~vr(i,n)||wr(i,n));return i},jr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");er.f=Object.getOwnPropertyNames||function(e){return Sr(e,jr)};var Tr={};Tr.f=Object.getOwnPropertySymbols;var Er=te,Or=er,xr=Tr,Rr=Vt,Pr=C([].concat),Nr=Er("Reflect","ownKeys")||function(e){var t=Or.f(Rr(e)),n=xr.f;return n?Pr(t,n(e)):t},kr=Qe,Ir=Nr,Ar=h,Cr=It,Dr=y,Ur=J,Vr=/#|\.prototype\./,qr=function(e,t){var n=zr[$r(e)];return n===Lr||n!==_r&&(Ur(t)?Dr(t):!!t)},$r=qr.normalize=function(e){return String(e).replace(Vr,".").toLowerCase()},zr=qr.data={},_r=qr.NATIVE="N",Lr=qr.POLYFILL="P",Mr=qr,Fr=m,Br=h.f,Gr=Jt,Hr=function(e,t,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:t;if(Jn(n)&&Yn(n,i,r),r.global)o?e[t]=n:Zn(t,n);else{try{r.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=n:Xn.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},Qr=Ue,Wr=function(e,t,n){for(var r=Ir(t),o=Cr.f,i=Ar.f,u=0;u<r.length;u++){var a=r[u];kr(e,a)||n&&kr(n,a)||o(e,a,i(t,a))}},Kr=Mr,Jr={},Xr=Oe,Yr=TypeError,Zr=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw new Yr("Bad Promise constructor");t=e,n=r}),this.resolve=Xr(t),this.reject=Xr(n)};Jr.f=function(e){return new Zr(e)};var eo=function(e,t){var n,r,o,i,u,a=e.target,c=e.global,s=e.stat;if(n=c?Fr:s?Fr[a]||Qr(a,{}):Fr[a]&&Fr[a].prototype)for(r in t){if(i=t[r],o=e.dontCallGetSet?(u=Br(n,r))&&u.value:n[r],!Kr(c?r:a+(s?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Wr(i,o)}(e.sham||o&&o.sham)&&Gr(i,"sham",!0),Hr(n,r,i,e)}},to=Jr;eo({target:"Promise",stat:!0},{withResolvers:function(){var e=to.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var no=e,ro=t,oo=function(e){return"Left"===e._tag},io=function(e,t){try{return ro(e())}catch(e){return no(t(e))}},uo={};!function(e){var t=p&&p.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(e,"__esModule",{value:!0}),e.dual=e.getEndomorphismMonoid=e.SK=e.hole=e.constVoid=e.constUndefined=e.constNull=e.constFalse=e.constTrue=e.unsafeCoerce=e.apply=e.getRing=e.getSemiring=e.getMonoid=e.getSemigroup=e.getBooleanAlgebra=void 0,e.identity=n,e.constant=r,e.flip=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.length>1?e(t[1],t[0]):function(n){return e(n)(t[0])}}},e.flow=o,e.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},e.increment=function(e){return e+1},e.decrement=function(e){return e-1},e.absurd=i,e.tupled=function(e){return function(t){return e.apply(void 0,t)}},e.untupled=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e(t)}},e.pipe=function(e,t,n,r,o,i,u,a,c){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return o(r(n(t(e))));case 6:return i(o(r(n(t(e)))));case 7:return u(i(o(r(n(t(e))))));case 8:return a(u(i(o(r(n(t(e)))))));case 9:return c(a(u(i(o(r(n(t(e))))))));default:for(var s=arguments[0],l=1;l<arguments.length;l++)s=arguments[l](s);return s}},e.not=function(e){return function(t){return!e(t)}};e.getBooleanAlgebra=function(e){return function(){return{meet:function(t,n){return function(r){return e.meet(t(r),n(r))}},join:function(t,n){return function(r){return e.join(t(r),n(r))}},zero:function(){return e.zero},one:function(){return e.one},implies:function(t,n){return function(r){return e.implies(t(r),n(r))}},not:function(t){return function(n){return e.not(t(n))}}}}};e.getSemigroup=function(e){return function(){return{concat:function(t,n){return function(r){return e.concat(t(r),n(r))}}}}};e.getMonoid=function(t){var n=(0,e.getSemigroup)(t);return function(){return{concat:n().concat,empty:function(){return t.empty}}}};e.getSemiring=function(e){return{add:function(t,n){return function(r){return e.add(t(r),n(r))}},zero:function(){return e.zero},mul:function(t,n){return function(r){return e.mul(t(r),n(r))}},one:function(){return e.one}}};e.getRing=function(t){var n=(0,e.getSemiring)(t);return{add:n.add,mul:n.mul,one:n.one,zero:n.zero,sub:function(e,n){return function(r){return t.sub(e(r),n(r))}}}};function n(e){return e}function r(e){return function(){return e}}function o(e,t,n,r,o,i,u,a,c){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return o(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return i(o(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return u(i(o(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return a(u(i(o(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return c(a(u(i(o(r(n(t(e.apply(this,arguments)))))))))}}}function i(e){throw new Error("Called `absurd` function which should be uncallable")}e.apply=function(e){return function(t){return t(e)}},e.unsafeCoerce=n,e.constTrue=r(!0),e.constFalse=r(!1),e.constNull=r(null),e.constUndefined=r(void 0),e.constVoid=e.constUndefined,e.hole=i;e.SK=function(e,t){return t};e.getEndomorphismMonoid=function(){return{concat:function(e,t){return o(e,t)},empty:n}};e.dual=function(e,n){var r="number"==typeof e?function(t){return t.length>=e}:e;return function(){var e=Array.from(arguments);return r(arguments)?n.apply(this,e):function(r){return n.apply(void 0,t([r],e,!1))}}}}(uo);var ao=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,a)}c((r=r.apply(e,t||[])).next())})},co=function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};const so=/\{[^{}]+\}/g;function lo(e){let{baseUrl:t="",Request:n=globalThis.Request,fetch:r=globalThis.fetch,querySerializer:o,bodySerializer:i,headers:u,requestInitExt:a,...c}={...e};a="object"==typeof process&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici?a:void 0,t=vo(t);const s=[];async function l(e,l){const{baseUrl:f,fetch:p=r,Request:d=n,headers:m,params:h={},parseAs:y="json",querySerializer:b,bodySerializer:v=i??yo,body:g,...w}=l||{};let S=t;f&&(S=vo(f)??t);let j="function"==typeof o?o:ho(o);b&&(j="function"==typeof b?b:ho({..."object"==typeof o?o:{},...b}));const T=void 0===g?void 0:v(g,bo(u,m,h.header)),E=bo(void 0===T||T instanceof FormData?{}:{"Content-Type":"application/json"},u,m,h.header),O={redirect:"follow",...c,...w,body:T,headers:E};let x,R,P,N=new n(function(e,t){let n=`${t.baseUrl}${e}`;t.params?.path&&(n=function(e,t){let n=e;for(const r of e.match(so)??[]){let e=r.substring(1,r.length-1),o=!1,i="simple";if(e.endsWith("*")&&(o=!0,e=e.substring(0,e.length-1)),e.startsWith(".")?(i="label",e=e.substring(1)):e.startsWith(";")&&(i="matrix",e=e.substring(1)),!t||void 0===t[e]||null===t[e])continue;const u=t[e];Array.isArray(u)?n=n.replace(r,mo(e,u,{style:i,explode:o})):n="object"!=typeof u?"matrix"!==i?n.replace(r,"label"===i?`.${encodeURIComponent(u)}`:encodeURIComponent(u)):n.replace(r,`;${fo(e,u)}`):n.replace(r,po(e,u,{style:i,explode:o}))}return n}(n,t.params.path));let r=t.querySerializer(t.params.query??{});r.startsWith("?")&&(r=r.substring(1));r&&(n+=`?${r}`);return n}(e,{baseUrl:S,params:h,querySerializer:j}),O);for(const e in w)e in N||(N[e]=w[e]);if(s.length){x=Math.random().toString(36).slice(2,11),R=Object.freeze({baseUrl:S,fetch:p,parseAs:y,querySerializer:j,bodySerializer:v});for(const t of s)if(t&&"object"==typeof t&&"function"==typeof t.onRequest){const r=await t.onRequest({request:N,schemaPath:e,params:h,options:R,id:x});if(r){if(!(r instanceof n)){if(r instanceof Response){P=r;break}throw new Error("onRequest: must return new Request() or Response() when modifying the request")}N=r}}}if(!P){try{P=await p(N,a)}catch(k){let t=k;if(s.length)for(let n=s.length-1;n>=0;n--){const r=s[n];if(r&&"object"==typeof r&&"function"==typeof r.onError){const n=await r.onError({request:N,error:t,schemaPath:e,params:h,options:R,id:x});if(n){if(n instanceof Response){t=void 0,P=n;break}if(n instanceof Error){t=n;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(t)throw t}if(s.length)for(let t=s.length-1;t>=0;t--){const n=s[t];if(n&&"object"==typeof n&&"function"==typeof n.onResponse){const t=await n.onResponse({request:N,response:P,schemaPath:e,params:h,options:R,id:x});if(t){if(!(t instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");P=t}}}}if(204===P.status||"HEAD"===N.method||"0"===P.headers.get("Content-Length"))return P.ok?{data:void 0,response:P}:{error:void 0,response:P};if(P.ok)return"stream"===y?{data:P.body,response:P}:{data:await P[y](),response:P};let k=await P.text();try{k=JSON.parse(k)}catch{}return{error:k,response:P}}return{request:(e,t,n)=>l(t,{...n,method:e.toUpperCase()}),GET:(e,t)=>l(e,{...t,method:"GET"}),PUT:(e,t)=>l(e,{...t,method:"PUT"}),POST:(e,t)=>l(e,{...t,method:"POST"}),DELETE:(e,t)=>l(e,{...t,method:"DELETE"}),OPTIONS:(e,t)=>l(e,{...t,method:"OPTIONS"}),HEAD:(e,t)=>l(e,{...t,method:"HEAD"}),PATCH:(e,t)=>l(e,{...t,method:"PATCH"}),TRACE:(e,t)=>l(e,{...t,method:"TRACE"}),use(...e){for(const t of e)if(t){if("object"!=typeof t||!("onRequest"in t||"onResponse"in t||"onError"in t))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");s.push(t)}},eject(...e){for(const t of e){const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}}function fo(e,t,n){if(null==t)return"";if("object"==typeof t)throw new Error("Deeply-nested arrays/objects aren’t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${!0===n?.allowReserved?t:encodeURIComponent(t)}`}function po(e,t,n){if(!t||"object"!=typeof t)return"";const r=[],o={simple:",",label:".",matrix:";"}[n.style]||"&";if("deepObject"!==n.style&&!1===n.explode){for(const e in t)r.push(e,!0===n.allowReserved?t[e]:encodeURIComponent(t[e]));const o=r.join(",");switch(n.style){case"form":return`${e}=${o}`;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return o}}for(const o in t){const i="deepObject"===n.style?`${e}[${o}]`:o;r.push(fo(i,t[o],n))}const i=r.join(o);return"label"===n.style||"matrix"===n.style?`${o}${i}`:i}function mo(e,t,n){if(!Array.isArray(t))return"";if(!1===n.explode){const r={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[n.style]||",",o=(!0===n.allowReserved?t:t.map(e=>encodeURIComponent(e))).join(r);switch(n.style){case"simple":return o;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return`${e}=${o}`}}const r={simple:",",label:".",matrix:";"}[n.style]||"&",o=[];for(const r of t)"simple"===n.style||"label"===n.style?o.push(!0===n.allowReserved?r:encodeURIComponent(r)):o.push(fo(e,r,n));return"label"===n.style||"matrix"===n.style?`${r}${o.join(r)}`:o.join(r)}function ho(e){return function(t){const n=[];if(t&&"object"==typeof t)for(const r in t){const o=t[r];if(null!=o)if(Array.isArray(o)){if(0===o.length)continue;n.push(mo(r,o,{style:"form",explode:!0,...e?.array,allowReserved:e?.allowReserved||!1}))}else"object"!=typeof o?n.push(fo(r,o,e)):n.push(po(r,o,{style:"deepObject",explode:!0,...e?.object,allowReserved:e?.allowReserved||!1}))}return n.join("&")}}function yo(e,t){if(e instanceof FormData)return e;if(t){if("application/x-www-form-urlencoded"===(t.get instanceof Function?t.get("Content-Type")??t.get("content-type"):t["Content-Type"]??t["content-type"]))return new URLSearchParams(e).toString()}return JSON.stringify(e)}function bo(...e){const t=new Headers;for(const n of e){if(!n||"object"!=typeof n)continue;const e=n instanceof Headers?n.entries():Object.entries(n);for(const[n,r]of e)if(null===r)t.delete(n);else if(Array.isArray(r))for(const e of r)t.append(n,e);else void 0!==r&&t.set(n,r)}return t}function vo(e){return e.endsWith("/")?e.substring(0,e.length-1):e}var go,wo,So=(null===(wo=null===(go=window.Roblox)||void 0===go?void 0:go.Cookies)||void 0===wo?void 0:wo.getBrowserTrackerId)||function(){return"unknown"},jo=function(e,t){var n=lo({baseUrl:e()});return a(t)||n.use.apply(n,t.value),n},To=function(){var e,t,n,r=null!==(n=null===(t=null===(e=window.Roblox)||void 0===e?void 0:e.EnvironmentUrls)||void 0===t?void 0:t.apiGatewayUrl)&&void 0!==n?n:"NOT_FOUND";return"".concat(r,"/account-security-service")},Eo=To(),Oo=jo(function(){return Eo},n),xo="rbxIndexedDBSmokeTest",Ro=function(n){return l(void 0,[n],void 0,function(n){var r=n.name,o=n.labelValues,i=n.identifier,u=n.withTelemetry,a=n.client;return f(this,function(n){switch(n.label){case 0:return u?[4,(c=function(){return l(void 0,void 0,void 0,function(){return f(this,function(e){return[2,(a||Oo).POST("/v1/metrics/record",{baseUrl:To(),body:{identifier:i||So(),name:r||xo,labelValues:o,value:1}})]})})},s=function(){},function(){return ao(void 0,void 0,void 0,function(){var n;return co(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c().then(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,e(s(n))];case 3:return[2]}})})})()]:[2];case 1:return n.sent(),[2]}var c,s})})},Po=function(e){var t,n=e.database,r=e.oldVersion,o=e.objectStoreName,i=e.instrumentationName,u=e.withTelemetry,a=Promise.withResolvers(),c=a.promise,s=a.resolve,l=a.reject;switch(r){default:if(n.objectStoreNames.contains(o)){Ro({name:i,labelValues:{success:"true",arm:"transaction-upgrade-objstore-exists"},withTelemetry:null==u||u}),s(null);break}uo.pipe(io(function(){return n.createObjectStore(o)},function(e){var t,n="unknownerr-create-objstore";return Ro({name:i,labelValues:{success:"false",arm:"transaction-upgrade-objstore-creation",error:null!==(t=e instanceof Error&&(null==e?void 0:e.message)||n)&&void 0!==t?t:n},withTelemetry:null==u||u}),l(new Error("Could not create object store.")),no(e)}),(t=function(e){return Ro({name:i,labelValues:{success:"true",arm:"transaction-upgrade-objstore-creation"},withTelemetry:null==u||u}),s(e)},function(e){return oo(e)?e:ro(t(e.right))}))}return c},No=function(e){var t=e.request,i=e.objectStoreName,a=e.upgradesHandler,c=e.withTelemetry,s=e.instrumentationName,p=Promise.withResolvers(),d=p.promise,m=p.resolve,h=p.reject;return t.onsuccess=function(e){var t=e.target.result;Ro({name:s,labelValues:{success:"true",arm:"connection"},withTelemetry:null==c||c}),m(t)},t.onerror=function(e){var t,n=e.target.error;Ro({name:s,labelValues:{success:"false",arm:"connection",error:null!==(t=null==n?void 0:n.message)&&void 0!==t?t:"unknown-onerror"},withTelemetry:null==c||c}),h(n)},t.onupgradeneeded=function(e){return l(void 0,void 0,void 0,function(){var t,l,p,h;return f(this,function(f){switch(f.label){case 0:return t=e.target,l=t.result,[4,a({database:l,oldVersion:e.oldVersion,objectStoreName:i,instrumentationName:s,withTelemetry:c})];case 1:return p=f.sent(),h=uo.pipe(null==(y=p)?n:r(y),o(function(e){return e.transaction.oncomplete=function(){Ro({name:s,labelValues:{success:"true",arm:"connection-initial-transaction"},withTelemetry:null==c||c}),m(l)},d})),u(h)?[2]:(Ro({name:s,labelValues:{success:"true",arm:"connection-initial-transaction-early"},withTelemetry:null==c||c}),m(l),[2])}var y})})},t.onblocked=function(e){var t=e.target.result;Ro({name:s,labelValues:{success:"true",arm:"connection-blocked"},withTelemetry:null==c||c}),t.close()},d},ko=function(e){var t=e.databaseName,n=e.objectStoreName,r=e.version,o=e.instrumentationName,u=e.withTelemetry,a=indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;return uo.pipe(io(function(){return Ro({name:o,labelValues:{success:"true",arm:"open-connection"},withTelemetry:null==u||u}),No({request:a.open(t,r),objectStoreName:n,upgradesHandler:Po,instrumentationName:o,withTelemetry:null==u||u})},function(e){var t,n="unknownerr-open-connection";return Ro({name:o,labelValues:{success:"false",arm:"open-connection",error:null!==(t=e instanceof Error&&(null==e?void 0:e.message)||n)&&void 0!==t?t:n},withTelemetry:null==u||u}),e}),i)},Io=function(e){var t=e.database,o=e.objectStoreName,i=e.key,u=e.instrumentationName,a=e.withTelemetry;if(!t.objectStoreNames.contains(o))return n;var c=Promise.withResolvers(),s=c.promise,l=c.resolve,f=t.transaction(o,"readonly");return f.oncomplete=function(){Ro({name:u,labelValues:{success:"true",arm:"transaction-get-complete"},withTelemetry:null==a||a})},f.objectStore(o).get(i).onsuccess=function(e){var t=e.target.result;Ro({name:u,labelValues:{success:"true",arm:"transaction-get"},withTelemetry:null==a||a}),l(t)},r(s)},Ao=function(e){var t=e.database,o=e.objectStoreName,i=e.key,u=e.value,a=e.instrumentationName,c=e.withTelemetry;if(!t.objectStoreNames.contains(o))return n;var s=Promise.withResolvers(),l=s.promise,f=s.resolve,p=t.transaction(o,"readwrite");return p.oncomplete=function(){Ro({name:a,labelValues:{success:"true",arm:"transaction-put-complete"},withTelemetry:null==c||c})},p.objectStore(o).put(u,i).onsuccess=function(e){var t=e.target.result;Ro({name:a,labelValues:{success:"true",arm:"transaction-put"},withTelemetry:null==c||c}),f(t)},r(l)},Co=function(){var e,t,n,r=null!==(n=null===(t=null===(e=window.Roblox)||void 0===e?void 0:e.EnvironmentUrls)||void 0===t?void 0:t.apiGatewayUrl)&&void 0!==n?n:"NOT_FOUND";return"".concat(r,"/rotating-client-service")}(),Do=jo(function(){return Co},n),Uo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l(void 0,function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0),void 0,function(e){var t;return void 0===e&&(e=Do),f(this,function(n){switch(n.label){case 0:return[4,e.GET("/v1/metadata")];case 1:return(t=n.sent()).error?[2,{enableIndexedDbTelemetry:!1}]:[2,t.data]}})})},Vo="rbxInstrumentationStore",qo="rbxTimestamp",$o=function(){return l(void 0,void 0,void 0,function(){var e,t,n,r,i,u;return f(this,function(s){switch(s.label){case 0:return[4,Uo()];case 1:return s.sent().enableIndexedDbTelemetry?(e=ko({databaseName:"rbxInstrumentationDb",objectStoreName:Vo,version:1}),a(e)?(Ro({name:xo,labelValues:{success:"false",arm:"connection-consumer"},withTelemetry:!0}),[2]):[4,e.value]):[2];case 2:return t=s.sent(),n=Io({database:t,objectStoreName:Vo,key:qo}),a(n)?(Ro({name:xo,labelValues:{success:"false",arm:"get-consumer"},withTelemetry:!0}),[2]):[4,n.value];case 3:return void 0!==(r=s.sent())?(Ro({name:xo,labelValues:{success:"true",arm:"get-consumer",timestamp:r.toString()},withTelemetry:!0}),[2]):(i=(new Date).getTime(),u=Ao({database:t,objectStoreName:Vo,key:qo,value:i}),uo.pipe(u,o(function(){return{success:"true",arm:"put-consumer",timestamp:i.toString()}}),c(function(){return{success:"false",arm:"put-consumer",timestamp:i.toString()}}),function(e){return Ro({name:xo,labelValues:e,withTelemetry:!0})}),[2])}})})};export{s as BoundedEventPublisher,xo as DEFAULT_INSTRUMENTATION_NAME,jo as clientProvider,No as getPromisifiedConnection,Io as getWithDefaultHandlers,$o as instrumentTimestamp,Ro as publishMetric,Ao as putWithDefaultHandlers,ko as tryGetIndexedDBConnectionWithDefaults};
